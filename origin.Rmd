---
title: "RRproject2"
author: "Hanwenmiao436819"
date: "2024-06-08"
output: html_notebook
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r,eval = FALSE}
# Setting the begining and ending
setwd("C:/Users/lulut/Desktop/RR2")
today <- as.Date("2022-02-23")
year_ago <- as.Date(today - 365)
# Three company for data extraction
company_list <- c("TSLA", "MSFT", "AMZN")

library(quantmod)
for (company in company_list) {
  assign(company, getSymbols(company, src = 'yahoo', from = year_ago, to = today, auto.assign = FALSE))
}
save.image(file = "Data.RData")
library(dplyr)
library(corrplot)
library(ggplot2)
library(GGally)
library(xts)
library(MASS)
library(gridExtra)
```
```{r}
rm(list = ls())
load("Data.RData")

for(i in 1:20){
  print(head(eval(parse(text =company_list[i])), 5))
}
```
```{r}
for(i in 1:3){
  temp <- eval(parse(text =company_list[i]))
  colnames(temp) = c("Open","High","Low","Close","Volume","Adjusted")
  assign(company_list[i],temp)
}
rm(temp)
```

```{r,include=FALSE}
Sys.setlocale ("LC_TIME", "English")

```
```{r}
for(i in 1:length(company_list)){
  print(plot(eval(parse(text =company_list[i]))$Adjusted, main = paste0(company_list[i]," Adjusted Close Price"), ylab = "Price", xlab = "Date", type = "l", col = "blue"))
}
```
##Moving averageÂ¶
Moving average - function whose value at each point is equal to some average value of the original function for the previous period.

Formula for calculations:

SUM = sum of prices for past x days; MA = SUM / x
```{r}
MA_days <- c(10, 20, 30)
 
for(i in 1:3){
  temp = eval(parse(text =company_list[i]))
  temp$`MA10` <- rollmean(temp$Adjusted, k = 10, fill = NA,align = "right")
  temp$`MA20` <- rollmean(temp$Adjusted, k = 20, fill = NA,align = "right")
  temp$`MA30` <- rollmean(temp$Adjusted, k = 30, fill = NA,align = "right")
  assign(company_list[i],temp)
}
rm(temp)

for(i in 1:20){
  print(head(eval(parse(text =company_list[i])), 5))
}
```
```{r}
plot_graphic <- function(company, company_string) {
  plot(company[,6:9], type = "l", xlab = "Date", ylab = "Price", main = company_string,col = 1:4,legend.loc = "topleft")
}



for (i in 1:length(company_list)) {   
  print(plot_graphic(eval(parse(text =company_list[i])), company_list[i]))
}
```

```{r}
for (i in 1:length(company_list)){
  temp = eval(parse(text =company_list[i]))
  temp$`Daily Returns` <- diff(temp$Adjusted)/stats::lag(temp$Adjusted, k = 1)
  assign(company_list[i],temp)
  hist(na.omit(temp$`Daily Returns`), breaks=50, col='dodgerblue', main=company_list[i], xlab='Daily Returns', ylab='Count',ylim = c(0,40))
  lines(density(na.omit(temp$`Daily Returns`)),col = "blue",lwd = 2)
}

```
```{r}
# Create dataframe with stock returns

stock_returns <- list()
for(i in 1:3){
  stock_returns[[i]] <- eval(parse(text =company_list[i]))$`Daily Returns`
}
stock_returns <- do.call(cbind,stock_returns)
colnames(stock_returns) <- company_list
head(stock_returns)
```

```{r,fig.height=8,fig.width=8}
# Plot pairplot
stock_returns <- na.omit(stock_returns)
ggpairs(stock_returns, 
        upper = list(continuous = wrap("cor", size = 3)), 
        lower = list(continuous = wrap("points", size = 0.5)),
        diag = list(continuous = wrap("barDiag", bins = 30, fill = "blue")))
```

```{r,fig.height=8,fig.width=8}
# Calculate the correlation matrix
corr = cor(stock_returns,use = "complete.obs")
  
# Create the correlogram
corrplot(corr, type = "lower", 
         method = "shade", 
         addCoef.col = "black", 
         tl.col = "black", tl.srt = 45)

```
