---
title: "Portfolio optimization of WIG20 stocks"
author: "Hanwen Miao 436819"
date: "2024-06-08"
output: html_notebook
---


```{r,eval = FALSE}
# Setting the path
setwd("C:/Users/lulut/Desktop/RRproject436819")
today <- Sys.Date()
year_ago <- as.Date(today - 365)
#Create a vector containing WIG20 company stocks, specifying the time range of the data, from last year to today this year
company_list <- c("ALR.WA", "ACP.WA", "PEO.WA", "CDR.WA", "CPS.WA", 
                  "DNP.WA", "GTN.WA", "JSW.WA", "KGH.WA", "KRU.WA", 
                  "LPP.WA", "MBK.WA", "OPL.WA", "PKO.WA", "PGE.WA", 
                  "PKN.WA", "SPL.WA", "TPE.WA", "PZU.WA", "CCC.WA")
#Load data from Yahoo Finance, and save it to an RDATA file
library(quantmod)
for (company in company_list) {
  assign(company, getSymbols(company, src = 'yahoo', from = year_ago, to = today, auto.assign = FALSE))
}      
save.image(file = "Data.RData")
print(ACP.WA)
library(dplyr)
library(corrplot)
library(ggplot2)
library(GGally)
library(xts)
library(MASS)
library(gridExtra)
```
```{r}
## Clear all objects in the current working environment so that when new data is loaded, there will be no interference from old data
rm(list = ls())
load("Data.RData")

for(i in 1:20){
  print(head(eval(parse(text =company_list[i])), 5))
}
```

```{r}
str(ALR.WA)

#Unify the column names of all company stock data to make subsequent data processing and analysis more convenient. 
for(i in 1:20){
  temp <- eval(parse(text =company_list[i]))
  colnames(temp) = c("Open","High","Low","Close","Volume","Adjusted")
  assign(company_list[i],temp)
}
rm(temp)
```

```{r,include=FALSE}
Sys.setlocale ("LC_TIME", "English")
```
```{r}
#Print the Adjusted Close Price line chart for each company. The adjusted closing price provides a more accurate price history
for(i in 1:length(company_list)){
  print(plot(eval(parse(text =company_list[i]))$Adjusted, main = paste0(company_list[i]," Adjusted Close Price"), ylab = "Price", xlab = "Date", type = "l", col = "blue"))
}
#From the line chart, we can see that except for Cyfrowy Polsat and CD Project, the stock prices of other companies have been relatively stable since June 2023.
```
```{r}
#Define a list MA_days. The author used three different moving average periods of 10, 20 and 30. These are the commonly used moving average days.
MA_days <- c(10, 20, 30)
#Since there are insufficient windows, so I fill in NA value.
for(i in 1:20){
  temp = eval(parse(text =company_list[i]))
  temp$`MA10` <- rollmean(temp$Adjusted, k = 10, fill = NA,align = "right")
  temp$`MA20` <- rollmean(temp$Adjusted, k = 20, fill = NA,align = "right")
  temp$`MA30` <- rollmean(temp$Adjusted, k = 30, fill = NA,align = "right")
  assign(company_list[i],temp)
}
rm(temp)

for(i in 1:20){
  print(head(eval(parse(text =company_list[i])), 5))
}
```
